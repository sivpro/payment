document.addEventListener("DOMContentLoaded",(function(){Inputmask().mask(document.querySelectorAll("input"));let e=.01*window.innerHeight;function t(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function n(e){let n=t(),o=function(e){let t=document.getElementById(e),n=t.offsetTop,o=t;for(;o.offsetParent&&o.offsetParent!=document.body;)o=o.offsetParent,n+=o.offsetTop;return n}(e),c=o>n?o-n:n-o;if(c<100)return void scrollTo(0,o);let a=Math.round(c/100);a>=20&&(a=20);let l=Math.round(c/25),d=o>n?n+l:n-l,i=0;if(o>n)for(let e=n;e<o;e+=l)setTimeout("window.scrollTo(0, "+d+")",i*a),d+=l,d>o&&(d=o),i++;else for(let e=n;e>o;e-=l)setTimeout("window.scrollTo(0, "+d+")",i*a),d-=l,d<o&&(d=o),i++}document.documentElement.style.setProperty("--vh",e+"px"),window.addEventListener("resize",()=>{let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",e+"px")});const o=document.querySelectorAll('a[href^="#"]');o&&o.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),e.getAttribute("href").length>1&&n(e.getAttribute("href").slice(1))})});const c=document.querySelector(".header");document.documentElement.style.setProperty("--height",c.getBoundingClientRect().height+"px");const a=document.querySelector(".report__slider .swiper-container");document.querySelector(".report__slider .swiper-button-next"),document.querySelector(".report__slider .swiper-button-prev");if(a){new Swiper(a,{spaceBetween:50,slidesPerView:1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{0:{slidesPerView:1},768:{slidesPerView:2,centeredSlides:!0,roundLengths:!0,loopAdditionalSlides:30}}})}const l=document.querySelectorAll(".quantity"),d=document.getElementsByClassName("quantity__minus"),i=document.getElementsByClassName("quantity__plus");let r=document.getElementsByClassName("quantity__number");l&&l.forEach((e,t)=>{d[t].addEventListener("click",()=>{1*r[t].value>=1&&(r[t].value=1*r[t].value-1)}),i[t].addEventListener("click",()=>{r[t].value=1*r[t].value+1})});const s=document.querySelectorAll(".input-group__input");document.querySelectorAll(".input-dropdown");console.log(s),s&&s.forEach(e=>{e.addEventListener("input",()=>{e.value.length>0&&e.nextElementSibling?e.nextElementSibling.classList.contains("input-dropdown")&&e.nextElementSibling.classList.add("input-dropdown--active"):e.value.length<1&&e.nextElementSibling&&e.nextElementSibling.classList.contains("input-dropdown--active")&&e.nextElementSibling.classList.remove("input-dropdown--active")}),e.addEventListener("focus",()=>{e.nextElementSibling.classList.contains("input-dropdown")&&e.nextElementSibling.classList.add("input-dropdown--active")}),e.addEventListener("focusout",t=>{setTimeout((function(){e.nextElementSibling.classList.contains("input-dropdown--active")&&e.nextElementSibling.classList.remove("input-dropdown--active")}),100)})});const u=document.querySelectorAll(".city_item"),m=document.getElementById("cities_placeholder"),p=(document.querySelectorAll(".region_item"),document.getElementById("regions_placeholder")),g=document.getElementById("regions_buttons"),h=document.getElementById("selected_jk"),y=document.getElementById("calc");document.getElementById("for_what_wrapper").addEventListener("click",(function(e){e.target&&e.target.matches("input[type='radio']")&&(console.log("Щёлк на для чего "+e.target.value),"for_home"===e.target.value?(document.getElementById("people_wrapper").classList.remove("s-none"),document.getElementById("people_add_wrapper").classList.remove("s-none")):(document.getElementById("people_wrapper").classList.add("s-none"),document.getElementById("people_add_wrapper").classList.add("s-none"))),document.querySelector('#calc > input[data-id="for_what"]').value=e.target.value})),u&&u.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),document.querySelector('#calc > input[name="city"]')&&document.querySelector('#calc > input[name="city"]').remove(),y.insertAdjacentHTML("beforeend",'<input type="hidden" name="city" value="'+t.target.dataset.city+'" data-id="city" />'),"input-dropdown__link city_item"===t.target.className?(t.stopPropagation(),console.log("мимо")):console.log(t.target.className);let n=document.getElementById("regions_li");n.innerHTML="",m.placeholder=e.innerHTML;let o={city_code:e.dataset.city};fetch("https://meter.sivpro.ru/getRegionsByCity",{method:"POST",body:JSON.stringify(o)}).then(e=>e.json()).then(e=>Object.entries(e).forEach(([e,t])=>{n.insertAdjacentHTML("beforeend",'<li class="input-dropdown__item"><a href="#" class="input-dropdown__link region_item" data-region="'+t+'">'+t+"</a> </li>")})).then(e=>f())})}),document.getElementById("flat-budget").addEventListener("keyup",(function(e){console.log("Бюжет изменение:"+e.target.value),document.querySelector('#calc > input[data-id="flat-budget"]').value=e.target.value})),document.getElementById("flat-aria").addEventListener("keyup",(function(e){console.log("Пощадь изменение:"+e.target.value),document.querySelector('#calc > input[data-id="flat-area"]').value=e.target.value})),document.querySelectorAll("#class_flat_wrapper > label > .class_flat_button").forEach(e=>{e.addEventListener("change",(function(){this.checked?(console.log("Checkbox is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)}))}),document.querySelectorAll("#type_flat_wrapper > label > .type_flat_button").forEach(e=>{e.addEventListener("change",(function(){this.checked?(console.log("Checkbox is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)}))}),document.querySelectorAll("#important_wrapper > label > .important_for_flat").forEach(e=>{e.addEventListener("change",(function(){this.checked?(console.log("Checkbox is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)}))}),document.getElementById("flat_for_dog").addEventListener("change",(function(){this.checked?(console.log("Checkbox dog is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox dog is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)})),document.getElementById("important_metro").addEventListener("change",(function(e){this.checked?(console.log("Checkbox dog is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox dog is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)})),document.getElementById("important_finish").addEventListener("change",(function(e){this.checked?(console.log("Checkbox dog is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox dog is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)})),document.getElementById("important_parking").addEventListener("change",(function(e){this.checked?(console.log("Checkbox dog is checked.."+this.id),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!0):(console.log("Checkbox dog is not checked.."),document.querySelector('#calc > input[data-id="'+this.id+'"]').checked=!1)}));const v=document.getElementById("report_no_needs"),_=document.getElementById("report_needs"),b=document.querySelectorAll(".report_need_include"),k=document.getElementById("available_projects_list");function f(){k.innerHTML="";let e=document.getElementById("calc");fetch("https://meter.sivpro.ru/reqtest",{method:"POST",body:new FormData(e)}).then(e=>e.json()).then(e=>{console.log(e);let t=[];e.items.forEach(e=>{t.push({name:e.name,coords:e.coordinates}),k.insertAdjacentHTML("beforeend",'<li class="input-dropdown__item available_project" data-id="'+e.code+'" data-name="'+e.name+'"><a href="#" class="input-dropdown__link region_item available_project" data-region="'+e.code+'">'+e.name+"</a> </li>")}),sessionStorage.setItem("yacoords",JSON.stringify(e)),document.getElementById("total").innerHTML=e.items.length,total_wrapper.style.setProperty("display","block"),e.items.length>0?get_projects_button.style.setProperty("display","inline-block"):get_projects_button.style.setProperty("display","none"),objectManager.removeAll(),objectManager.add(e.map)})}b.forEach(e=>{e.addEventListener("change",(function(t){let n=t.target.parentNode.parentNode.id;console.log("Исключи|включить в отчет "+n),"report_no_needs"===n?(console.log("Перемещаем в блок включить в отчет"),_.appendChild(e),y.insertAdjacentHTML("beforeend",'<input type="text" class name="report_includes[]" value="'+t.target.dataset.value+'"  />')):"report_needs"===n&&(console.log("Перемещаем в блок исключить из отчета "),v.appendChild(e),document.querySelector('#calc > input[value="'+t.target.dataset.value+'"]').remove())}))}),k.addEventListener("click",(function(e){if(e.preventDefault(),"input-dropdown__link region_item available_project"===e.target.className){let t=document.querySelector('[data-id="jk_'+e.target.dataset.region+'"]'),n=document.querySelectorAll('#calc > input[name="jks[]"]');if(n&&3===n.length)return alert("Максимально только 3 ЖК"),!0;if(t)console.log("уже есть");else{let t='<label for="apartment-checkbox-01" class="btn-checkbox projects__checkbox" data-id="'+e.target.dataset.region+'" data-name="'+e.target.innerHTML+'">\n                        <input type="checkbox" class="btn-checkbox__input" id="apartment-checkbox-01"  checked>\n                        <span class="btn-checkbox__label" data-id="jk_'+e.target.dataset.region+'">'+e.target.innerHTML+'</span>\n                        <span class="btn-checkbox__icon"></span>\n                    </label>';h.insertAdjacentHTML("beforeend",t),y.insertAdjacentHTML("beforeend",'<input type="hidden" name="jks[]" value="'+e.target.dataset.region+'" data-id="jk_'+e.target.dataset.region+'"/>')}}})),h.addEventListener("click",e=>{e.stopPropagation(),console.log("target:"),console.log(e.target);let t=e.target.dataset.id;console.log("currnet_dataset="+t),console.log('#calc > input[data-id="'+t+'"]'),document.querySelector('#calc > input[data-id="'+t+'"]').remove(),e.target.parentNode.remove(),e.target.remove()}),document.getElementById("by_raiting_button").addEventListener("click",(function(e){let t=document.querySelectorAll("#available_projects_list > li:nth-child(-n+3)");h.innerHTML="",document.querySelectorAll('#calc > input[name="jks[]"]').forEach(e=>{e.remove()}),console.log("по рейтингу"),console.log(t),t.forEach(e=>{console.log(),console.log(e.dataset),console.log(e.dataset.id),console.log(e.dataset.name);let t='<label for="apartment-checkbox-01" class="btn-checkbox projects__checkbox" data-id="'+e.dataset.id+'">\n                        <input type="checkbox" class="btn-checkbox__input" id="apartment-checkbox-01"  checked>\n                        <span class="btn-checkbox__label" data-id="jk_'+e.dataset.id+'">'+e.dataset.name+'</span>\n                        <span class="btn-checkbox__icon"></span>\n                    </label>';h.insertAdjacentHTML("beforeend",t),y.insertAdjacentHTML("beforeend",'<input type="hidden" name="jks[]" value="'+e.dataset.id+'" data-id="jk_'+e.dataset.id+'"/>')})})),document.addEventListener("click",e=>{}),document.getElementById("region_wrapper").addEventListener("click",e=>{if(console.log(e.target.className),e.preventDefault(),"input-dropdown__link region_item"===e.target.className){console.log("clicked on region item"),p.placeholder=e.target.innerHTML,document.querySelector('[data-id="region_'+e.target.innerHTML+'"]')?console.log("уже есть"):(g.insertAdjacentHTML("beforeend",'<label for="area-checkbox-01" class="btn-checkbox projects__checkbox" data-id="'+e.target.innerHTML+'" >\n                            <input type="checkbox" checked="checked" class="btn-checkbox__input region_buttons">\n                            <span class="btn-checkbox__label" data-id="region_'+e.target.innerHTML+'">'+e.target.innerHTML+'</span>\n                            <span class="btn-checkbox__icon"></span>\n                        </label>'),y.insertAdjacentHTML("beforeend",'<input type="hidden" name="region[]" value="'+e.target.innerHTML+'" data-id="region_'+e.target.innerHTML+'" />')),f()}},!1),g.addEventListener("click",e=>{e.stopPropagation(),console.log("click to delete region button"),console.log("target:"),console.log(e.target);let t=e.target.dataset.id;console.log("currnet_dataset="+t),console.log('#calc > input[data-id="'+t+'"]'),document.querySelector('#calc > input[data-id="'+t+'"]').remove(),e.target.parentNode.remove(),e.target.remove(),f()});const E=document.querySelectorAll(".modal-btn"),L=(document.querySelectorAll(".modal"),document.querySelectorAll(".modal__close")),S=document.querySelector(".overlay");E&&E.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.id;n&&(S.classList.contains("overlay--active")||S.classList.add("overlay--active"),document.querySelectorAll(".modal.modal--active").forEach(e=>e.classList.remove("modal--active")),document.body.classList.add("scroll-disabled"),document.getElementById(n).classList.add("modal--active"),document.getElementById(n).classList.contains("modal--sm")&&setTimeout(()=>{document.body.classList.remove("scroll-disabled"),document.querySelectorAll(".modal.modal--active").forEach(e=>e.classList.remove("modal--active")),S.classList.remove("overlay--active")},5e3))})}),document.body.addEventListener("keyup",e=>{27==e.keyCode&&S.classList.contains("overlay--active")&&(document.body.classList.remove("scroll-disabled"),document.querySelectorAll(".modal.modal--active").forEach(e=>e.classList.remove("modal--active")),S.classList.remove("overlay--active"))},!1),L&&L.forEach(e=>{e.addEventListener("click",()=>{S.classList.contains("overlay--active")&&(document.body.classList.remove("scroll-disabled"),document.querySelectorAll(".modal.modal--active").forEach(e=>e.classList.remove("modal--active")),S.classList.remove("overlay--active"))})}),S&&S.addEventListener("click",()=>{S.classList.contains("overlay--active")&&(document.body.classList.remove("scroll-disabled"),document.querySelectorAll(".modal.modal--active").forEach(e=>e.classList.remove("modal--active")),S.classList.remove("overlay--active"))})}));